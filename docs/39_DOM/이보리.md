# 39장 DOM

#### DOM<sup>Document Object Model</sup>
- HTML 문서의 계층적 구조와 정보를 표현하며 이를 제어할 수 있는 API
- 프로퍼티와 메서드를 제공하는 트리 자료구조

## 📂 39.1 노드
### HTML 요소와 노드 객체
- HTML 요소<sup>HTML element</sup> : HTML 문서를 구성하는 개별적인 요소
- HTML 문서는 HTML 요소들의 집합으로 이뤄지며, HTML 요소 간에는 중첩 관계에 의해 계층적인 부자 관계가 형성
- 이러한 HTML 요소 간의 부자 관계를 반영하여 HTML 문서의 구성 요소인 HTML 요소를 객체화한 모든 노드 객체들을 트리 자료구조로 구성

#### 트리 자료구조<sup>tree data structure</sup>
- 부모 노드<sup>parent node</sup>와 자식 노드<sup>child node</sup>로 구성되어 노드 간의 계층적 구조(부자, 형제 관계)를 표현하는 비선형 자료구조
- 트리 자료구조는 하나의 최상위 노드에서 시작
  - 루트 노드<sup>root node</sup> : 최상위 노드로 부모 노드가 없다.
  - 리프 노드<sup>leaf node</sup> : 자식 노드가 없는 노드
- 노드 객체의 트리로 구조화되어 있어 DOM을 **DOM 트리**라고도 부른다.

### 노드 객체의 타입
- 노드 객체는 총 12개의 노트 타입이 있다.

#### 문서 노드<sup>document node</sup>
- DOM 트리의 최상위에 존재하는 루트 노드로서 `document` 객체를 가리킴
- `document` 객체
  - 브라우저가 렌더링한 HTML 문서 전체를 가리키는 객체
  - HTML 문서당 `document` 객체는 유일
  - DOM 트리의 루트 노드이므로 DOM 트리의 노드들에 접근하기 위한 진입점

#### 요소 노드<sup>element node</sup>
- HTML 요소를 가리키는 객체
- HTML 요소 간의 중첩에 의해 부자 관계를 가지며, 이 부자 관계를 통해 정보를 구조화

#### 어트리뷰트 노드<sup>attribute node</sup>
- HTML 요소의 어트리뷰트를 가리키는 객체
- 어트리뷰트 노드는 어트리뷰트가 지정된 HTML 요소의 요소 노드에만 연걸되어 있다.
- 어트리뷰트를 참조하거나 변경하려면 먼저 요소 노드에 접근해야 한다.

#### 텍스트 노드<sup>text node</sup>
- HTML 요소의 텍스트를 가리키는 객체
- 요소 노드는 문서의 구조를 표현, 텍스트 노드는 문서의 정보를 표현
- 요소 노드의 자식 노드면서 리프 노드로 DOM 트리의 최종단
- 텍스트 노드에 접근하려면 먼저 요소 노드에 접근해야 한다.

### 노드 객체의 상속 구조
- DOM을 구성하는 노드 객체는 자신의 구조와 정보를 제어할 수 있는 DOM API를 사용하여 노드 객체가 자신의 부모, 형제, 자식을 탐색할 수 있고, 자신의 어트리뷰트와 텍스트를 조작할 수 있다.
- 노드 객체는 ECMAScript 사양에 정의된 표준 빌트인 객체가 아니라 브라우저 환경에서 추가적으로 제공하는 호스트 객체<sup>host object</sup>
- 노드 객체도 자바스크립트 객체이므로 프로토 타입에 의한 상속 구조를 가진다.

![](https://i.imgur.com/rm1Awu1.png)

- 모든 노드 객체는 Object, EventTarget, Node 인터페이스를 상속 받는다.
  - 요소 노드 객체는 HTML 요소가 갖는 공통적인 기능도 있고, 종류에 따라 고유한 기능도 있다.
- 노드 객체는 공통된 기능일수록 프로토타입 체인의 상위에, 개별적인 고유 기능일수록 프로토타입 체인의 하위에 프로토타입 체인을 구축
- 노드 타입에 따라 필요한 기능을 프로퍼티와 메서드의 집합인 DOM API를 제공
- **DOM API를 통해 HTML의 구조, 내용, 스타일 등을 동적으로 조작할 수 있다.**

## 📂 39.2 요소 노드 취득

- HTML 구조나 내용, 스타일 등을 동적으로 조작하기 위해 먼저 요소 노드를 취득해야 한다.
- 요소 노드의 취득은 HTML 요소를 조작하는 시작접

### `id`를 이용한 요소 노드 취득
#### `Document.prototype.getElementById` 메서드
- 인수로 전달된 `id` 어트리뷰트 값(`id` 값)을 갖는 첫 번째 요소 노드만 반환
- `id` 값은 HTML 문서 내의 유일한 값이어야 하지만 중복된 `id` 값을 갖는 HTML 요소가 여러 개 존재하더라도 에러가 발생하지 않는다.
- 인수로 전달된 `id` 값을 갖는 HTML 요소가 존재하지 않는 경우, `null` 반환
- HTML 요소에 `id` 어트리뷰트를 부여하면 `id` 값과 동일한 이름의 전역 변수가 암묵적으로 선언되고 해당 노드 객체가 할당된다.
  - `id` 값과 동일한 이름의 전역 변수가 이미 선언되어 있다면 이 전역 변수에 노드 객체가 재할당되지 않는다.

### 태그 이름을 이용한 요소 노드 취득
#### `Document.prototype/Element.prototype.getElementsByTagName` 메서드
- 인수로 전달한 태그 이름을 갖는 모든 요소 노드들을 탐색하여 반환
- 여러 개의 요소 노드 객체를 갖는 DOM 컬렉션 객체인 `HTMLCollection` 객체를 반환
- `Document.prototype.getElementsByTagName` : DOM의 루트 노드인 document를 통해 호출하여, DOM 전체에서 요소 노드를 탐색하여 반환
- `Element.prototype.getElementsByTagNam` : 특정 요소 노드를 통해 호출하여, 특정 요소 노드의 자손 노드 중에서 요소를 탐색하여 반환
- 인수로 `*`를 전달하면 HTML 문서의 모든 요소 노드 취득
- 인수로 전달된 태그 이름을 갖는 요소가 존재하지 않는 경우 빈 `HTMLCollection` 객체를 반환

### `class`를 이용한 요소 노드 취득
#### `Document.prototype/Element.prototype.getElementsByClassName` 메서드
- 인수로 전달된 `class` 어트리뷰트 값(`class` 값)을 갖는 모든 요소 노드들을 탐색하여 `HTMLCollection` 객체를 반환
- 인수로 전달할 `class` 값은 공백으로 구분하여 여러 개의 `class`를 지정할 수 있다.
- 인수로 전달된 `class` 값을 갖는 요소가 존재하지 않는 경우 빈 `HTMLCollection` 객체를 반환

### CSS 선택자를 이용한 요소 노드 취득
#### CSS 선택자<sup>selector</sup>
- 스타일을 적용하고자 하는 HTML 요소를 특정할 때 사용하는 문법
```css
/* 전체 선택자: 모든 요소를 선택 */
* { ... }

/* 태그 선택자: 모든 p 태그 요소를 모두 선택 */
p { ... }

/* id 선택자: id 값이 'foo'인 요소를 모두 선택 */
#foo { ... }

/* class 선택자: class 값이 'foo'인 요소를 모두 선택 */
.foo { ... }

/* 어트리뷰트 선택자: input 요소 중에 type 어트리뷰트 값이 'text'인 요소를 모두 선택 */
input[type=text] { ... }

/* 후손 선택자: div 요소의 후손 요소 중 p 요소를 모두 선택 */
div p { ... }

/* 자식 선택자: div 요소의 자식 요소 중 p 요소를 모두 선택 */
div > p { ... }

/* 인접 형제 선택자: p 요소의 형제 요소 중에 p 요소 바로 뒤에 위치하는 ul 요소를 선택 */
p + ul { ... }

/* 일반 형제 선택자: p 요소의 형제 요소 중에 p 요소 뒤에 위치하는 ul 요소를 모두 선택 */
p ~ ul { ... }

/* 가상 클래스 선택자: hover 상태인 a 요소를 모두 선택 */
a:hover { ... }

/* 가상 요소 선택자: p 요소의 콘텐츠의 앞에 위치하는 공간을 선택 */
p::before { ... }
```

#### `Document.prototype/Element.prototype.querySelector` 메서드
- 인수로 전달한 CSS 선택자를 만족시키는 하나의 요소 노드를 탐색하여 반환
- 인수로 전달한 CSS 선택자를 만족시키는 요소 노드가 여러 개인 경우, 첫 번째 노드만 반환
- 인수로 전달한 CSS 선택자를 만족시키는 요소 노드가 존재하지 않는 경우, `null` 반환
- 인수로 전달한 CSS 선택자가 문법에 맞지 않는 경우, `DOMException` 에러 발생

#### `Document.prototype/Element.prototype.querySelectorAll` 메서드
- 인수로 전달한 CSS 선택자를 만족시키는 모든 요소 노드를 탐색하여 반환
- 여러 개의 요소 노드 객체를 갖는 DOM 컬렉션 객체인 `NodeList` 객체를 반환
- 인수로 전달한 CSS 선택자를 만족시키는 요소 노드가 존재하지 않는 경우, 빈 `NodeList` 객체를 반환
- 인수로 전달한 CSS 선택자가 문법에 맞지 않는 경우, `DOMException` 에러 발생
- 인수로 `*`를 전달하면 HTML 문서의 모든 요소 노드 취득

> CSS 선택자 문법을 이용한 노드 취득이 `getElementBy***`에 비해 다소 느리다고 알려져 있지만, 좀 더 구체적인 조건 또는 일관된 방식으로 요소 노드를 취득할 수 있다는 장점이 있다.

### 특정 요소 노드를 취득할 수 있는지 확인
#### `Element.prototype.matches` 메서드
- 인수로 전달한 CSS 선택자를 통해 특정 요소 노드를 취득할 수 있는지 확인
- 이벤트 위임을 사용할 때 유용

```javascript
const $apple = document.querySelector('.apple');

// $apple 노드는 '#fruits > li.apple'로 취득할 수 있다.
console.log($apple.matches('#fruits > li.apple'));  // true

// $apple 노드는 '#fruits > li.banana'로 취득할 수 없다.
console.log($apple.matches('#fruits > li.banana')); // false
```

### `HTMLCollection`과 `NodeList`
- `HTMLCollection`과 `NodeList`는 DOM API가 여러 개의 결과값을 반환하기 위한 DOM 컬렉션 객체
- 모두 유사 배열 객체이면서 이터러블

#### `HTMLCollection`
- 노드 객체의 상태 변화를 실시간으로 반영하여 살아 있는<sup>live</sup> DOM 객체라고 부르기도 한다.
- 실시간으로 노드 객체의 상태 변경을 반영하므로 `for`문을 순회하면서 노드 객체의 상태를 변경해야할 때 주의가 필요
- 위의 문제 해결 방법
  - `for`문을 역방향으로 순회
  - `while`문 사용
  - `HTMLCollection` 객체를 배열로 변환하여 사용

#### `NodeList`
- 대부분의 경우 실시간으로 노드 객체의 상태 변경을 반영하지 않는 **non-live 객체**로 동작하지만 경우에 따라 live 객체로 동작
  - **`childNodes` 프로퍼티가 반환하는 `NodeList` 객체는 live 객체로 동작**
- `NodeList.prototype`은 `forEach`, `item`, `entries`, `keys`, `values` 메서드 제공

⇒ **노드 객체의 상태 변경과 상관없이 안전하게 DOM 컬렉션을 사용하려면 `HTMLCollection`이나 `NodeList` 객체를 배열로 변환하여 사용**
