# 📓 클로저

## 간단 요약 📑

### 1. 클로저는 자바스크립트 고유의 개념은 아니지만, 정의하자면 함수와 그 함수가 선언된 렉시컬 환경과의 조합이다.

### 2. 함수는 자신이 정의된 위치에서 상위 스코프가 정적으로 결정되고 변하지 않는데, 자신의 상위 스코프를 기억하기 위해 자신의 내부 슬롯 [[Environment]]에 상위 스코프의 참조를 저장한다.

### 3. 클로저는 중첩 함수가 상위 스코프의 식별자를 참조하고 있고, 중첩 함수가 외부 함수보다 더 오래 유지하는 경우에 한정하는 것이 일반적이다.

---

## ✌🏻렉시컬 스코프

### 자바스크립트 엔진은 함수를 어디서 호출했는지가 아니라 함수를 어디에 정의했는지에 따라 상위 스코프를 결정하고 이를 렉시컬 스코프(정적 스코프)라 한다.

- 함수의 상위 스코프는 함수를 정의한 위치에 의해 정적으로 결정되고 변하지 않는다.
- 스코프의 실체는 실행 컨텍스트의 렉시컬 환경이기 때문에 렉시컬 환경은 자신의 "외부 렉시컬 환경에 대한 참조"를 통해 상위 렉시컬 환경과 연결된다. 즉 스코프 체인이 연결된다.

## ✌🏻함수 객체의 내부 슬롯 [[Environment]]

### 함수는 자신의 정의된 환경, 즉 상위 스코프를 기억해야 하는데 이를 위해 함수는 자신의 내부 슬롯 [[Environment]]에 자신이 정의된 환경, 즉 상위 스코프의 참조를 저장한다.

- 상위 스코프의 참조는 *현재 실행 중인 실행 컨텍스트의 렉시컬 환경*을 가리킨다.
- 함수 렉시컬 환경의 구성 요소인 외부 렉시컬 환경에 대한 참조에는 함수 객체의 내부 슬롯 [[Environment]]에 저장된 렉시컬 환경의 참조가 할당된다.

## ✌🏻클로저와 렉시컬 환경

### 외부 함수보다 중첩 함수가 더 오래 유지되는 경우 중첩 함수는 이미 생명 주기가 종료한 외부 함수의 변수를 참조할 수 있다. 이러한 중첩 함수를 클로저라고 부른다.

- 자바스크립트의 모든 함수는 자신의 상위 스코프를 기억하고, 상위 스코프는 함수를 어디서 호출하든 상관없이 유지된다. 따라서 _함수는 자신이 기억하는 상위 스코프의 식별자를 참조할 수 있으며 식별자에 바인딩된 값을 변경할 수도 있다_.
- 실행 컨텍스트가 실행 컨텍스트 스택에서 제거되더라도 _렉시컬 환경까지 소멸하는 것은 아니다_. 가바지 컬렉터는 누군가가 참조하고 있는 메모리 공간을 함부로 해제하지 않기 때문이다.
- _상위 스코프의 어떤 식별자도 참조하지 않는 함수는 클로저가 아니다_. 중첩 함수일지라도 상위 스코프의 어떤 식별자도 참조하지 않는 경우 대부분의 모던 브라우저는 최적화를 통해 상위 스코프를 기억하지 않는다.
- _외부 함수보다 중첩 함수의 생명 주기가 짧다면 클로저가 아니다._ 상위 스코프의 식별자를 참조하지만 외부 함수보다 일찍 소멸된다면 생명 주기가 종료된 외부 함수의 식별자를 참조할 수 있다는 클로저의 본질에 부합하지 않는다.
- 클로저에 의해 참조되는 상위 스코프의 변수를 `자유 변수`라고 부른다. 클로저란 "함수가 자유 변수에 대해 닫혀있다"라는 의미로 "자유 변수에 묶여있는 함수"라고 할 수 있다.
